#!/usr/bin/python
# author: cbk914 
# 07/12/2020
# version 0.1

import nmap
import subprocess, re, sys

# Identify OS

#def scan(address):
#    proc = subprocess.Popen(["nmap -sC -sV -Pn -T5 %s" % address, -oG  ""], stdout=subprocess.PIPE, shell=True)
#    (out, err) = proc.communicate()
#    out = out.split()
#    out = re.findall(r"\d{1,3}",out[12])
#    return out[0]

def return_ttl(address):
    proc = subprocess.Popen(["ping -c 1 %s" % address, ""], stdout=subprocess.PIPE, shell=True)
    (out, err) = proc.communicate()
    out = out.split()
    out = re.findall(r"\d{1,3}",out[12])
    return out[0]

# https://subinsb.com/default-device-ttl-values

def return_ttl_os_name(ttl_number):
        
    if ttl_number >=0 and ttl_number <=64:
        return "Unix/Linux"
    elif ttl_number >=65 and ttl_number<=128:
        return "Windows"
    elif ttl_number >=129 and ttl_number<=254:
        return "Solaris/AIX"
    else:
        return "Unknown"

if len(sys.argv) != 2:
    print "\n[*] Usage: python " + sys.argv[0] + " <ip-address>\n"
    sys.exit(1)

if __name__ == '__main__':
    addr = sys.argv[1]
    ttl = return_ttl(addr)
    
    try:
        print "\n%s -> %s" % ((addr, return_ttl_os_name(int(ttl)))) 
        print "\n"+ ttl_number
    except:
        pass

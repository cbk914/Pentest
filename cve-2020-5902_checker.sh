#!/bin/bash
# Author: cbk914
# Simple script to find F5 BIG IP devices vulnerable to CVE-2020-5902
# Dependencies: 
# Nmap https://github.com/nmap/nmap  
# NSE script: https://raw.githubusercontent.com/RootUp/PersonalStuff/master/http-vuln-cve2020-5902.nse
# Nuclei: https://github.com/projectdiscovery/nuclei
# Template: https://github.com/projectdiscovery/nuclei-templates/blob/master/cves/CVE-2020-5902.yaml


print_green() {
    BOLD_GREEN=$(tput bold ; tput setaf 2)
    NORMAL=$(tput sgr0)
    echo "${BOLD_GREEN}$1${NORMAL}"
}

print_yellow() {
    BOLD_YELLOW=$(tput bold ; tput setaf 3)
    NORMAL=$(tput sgr0)
    echo "${BOLD_YELLOW}$1${NORMAL}"
}

print_red() {
    BOLD_YELLOW=$(tput bold ; tput setaf 1)
    NORMAL=$(tput sgr0)
    echo "${BOLD_YELLOW}$1${NORMAL}"
}

print_blue() {
    BOLD_YELLOW=$(tput bold ; tput setaf 4)
    NORMAL=$(tput sgr0)
    echo "${BOLD_YELLOW}$1${NORMAL}"
}

print_delimiter() {
    echo
    echo "-------------------------------------------------------------------------------"
    echo
}


clear
print_green "###############################################################"
print_green "# CVE-2020-5902 CHECKER                                       #"
print_green "# author: cbk914						   #"
print_green "###############################################################"
print_delimiter

print_yellow "[*] TARGET IP/CIDR RANGE?"
print_red "[-] ATTENTION: NO DNS HOSTNAMES!!"
read CIDR
print_delimiter

REGEX="(((25[0-5]|2[0-4][0-9]|1?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|1?[0-9][0-9]?))(\/([1-9]|[1-2][0-9]|3[0-2]))([^0-9.]|$)"

if echo $CIDR | grep -qP "$REGEX"
then
  print_green "$CIDR OK! Let's proceed..."
  #exit 0
else
  print_red "$CIDR NOT OK! Write a correct IP or CIDR Range"
  exit 1
fi

print_delimiter
print_blue "[+] SCANNING AND GENERATING LIST OF DETECTED F5 BIG IP DEVICES..."
nmap -p443 $CIDR --script=http-vuln-cve2020-5902.nse -oG - | awk '/Up$/{print $2}' > targets.txt
sleep 3

print_green "[+] LIST GENERATED"

sleep 2

print_blue "[+] CHECKING TARGETS' LIST FOR VULNERABLE DEVICES AND REPORTING (see vulnerable.txt)"
nuclei -t ~/nuclei/nuclei-templates/cves/CVE-2020-5902.yaml -l targets.txt -o vulnerable.txt
# Change Nuclei's template directory for your own

exit 0

